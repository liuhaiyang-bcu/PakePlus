<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡ä¼˜åŒ–æµ‹è¯•å·¥å…·</title>
    <link rel="icon" href="img/logo.png" type="image/png">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .demo-section h3 {
            margin-top: 0;
            color: #4285f4;
        }
        .test-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .test-btn.primary {
            background: #4285f4;
            color: white;
        }
        .test-btn.primary:hover {
            background: #3367d6;
        }
        .test-btn.secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        .test-btn.secondary:hover {
            background: #e9ecef;
        }
        .test-btn.danger {
            background: #ea4335;
            color: white;
        }
        .test-btn.danger:hover {
            background: #d33b2c;
        }
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }
        .info-box h4 {
            margin-top: 0;
            color: #1976d2;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4285f4;
            margin-bottom: 4px;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .upload-demo {
            border: 2px dashed #4285f4;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 16px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-demo:hover {
            border-color: #3367d6;
            background: #f8f9ff;
        }
        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ‰¹é‡å›¾ç‰‡ä¼˜åŒ–æµ‹è¯•å·¥å…·</h1>
        
        <div class="demo-section">
            <h3>ğŸ“Š å½“å‰å­˜å‚¨ç»Ÿè®¡</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="scanImages()">æ‰«æå›¾ç‰‡</button>
                <button class="test-btn secondary" onclick="showStats()">æ˜¾ç¤ºç»Ÿè®¡</button>
                <button class="test-btn secondary" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
            </div>
            <div id="stats-container" class="stats-grid"></div>
            <div id="log" class="log-area"></div>
        </div>

        <div class="demo-section">
            <h3>ğŸ–¼ï¸ æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•</h3>
            <div class="info-box">
                <h4>æµ‹è¯•è¯´æ˜</h4>
                <p>è¿™äº›æŒ‰é’®ä¼šåˆ›å»ºæ¨¡æ‹Ÿçš„æ‰“å¡æ•°æ®ï¼ŒåŒ…å«ä¸åŒå¤§å°çš„å›¾ç‰‡ï¼Œç”¨äºæµ‹è¯•æ‰¹é‡ä¼˜åŒ–åŠŸèƒ½ã€‚</p>
            </div>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="createTestData(5)">åˆ›å»º5ä¸ªæµ‹è¯•æ‰“å¡</button>
                <button class="test-btn primary" onclick="createTestData(10)">åˆ›å»º10ä¸ªæµ‹è¯•æ‰“å¡</button>
                <button class="test-btn secondary" onclick="addLargeImages()">æ·»åŠ å¤§å›¾ç‰‡</button>
                <button class="test-btn danger" onclick="clearTestData()">æ¸…é™¤æµ‹è¯•æ•°æ®</button>
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸš€ æ‰¹é‡ä¼˜åŒ–æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="startOptimization()">å¼€å§‹æ‰¹é‡ä¼˜åŒ–</button>
                <button class="test-btn secondary" onclick="optimizeWithSettings()">è‡ªå®šä¹‰ä¼˜åŒ–</button>
                <button class="test-btn secondary" onclick="showOptimizationModal()">æ˜¾ç¤ºä¼˜åŒ–å¼¹çª—</button>
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸ“ å®é™…å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</h3>
            <div class="upload-demo" onclick="document.getElementById('testFileInput').click()">
                <div>ğŸ“· ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡è¿›è¡Œæµ‹è¯•</div>
                <div style="font-size: 12px; color: #666; margin-top: 8px;">
                    ä¸Šä¼ çš„å›¾ç‰‡ä¼šè¢«æ·»åŠ åˆ°æµ‹è¯•æ‰“å¡ä¸­ï¼Œç„¶åå¯ä»¥æµ‹è¯•æ‰¹é‡ä¼˜åŒ–
                </div>
                <input type="file" id="testFileInput" class="file-input" multiple accept="image/*">
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸ”„ æ•°æ®ç®¡ç†</h3>
            <div class="test-buttons">
                <button class="test-btn secondary" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                <button class="test-btn secondary" onclick="importData()">å¯¼å…¥æ•°æ®</button>
                <button class="test-btn secondary" onclick="createBackup()">åˆ›å»ºå¤‡ä»½</button>
                <button class="test-btn danger" onclick="resetAll()">é‡ç½®æ‰€æœ‰æ•°æ®</button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="js/storage.js"></script>
    <script src="js/image-compressor.js"></script>
    <script src="js/image-optimizer.js"></script>
    <script src="js/image-batch-optimizer.js"></script>

    <script>
        let testOptimizer;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            testOptimizer = new ImageBatchOptimizer();
            log('æ‰¹é‡ä¼˜åŒ–æµ‹è¯•å·¥å…·å·²åˆå§‹åŒ–');
            scanImages();
        });

        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logArea = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logArea.textContent += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        // æ‰«æå›¾ç‰‡
        function scanImages() {
            try {
                const images = testOptimizer.scanAllDakaImages();
                log(`æ‰«æå®Œæˆï¼Œæ‰¾åˆ° ${images.length} å¼ å›¾ç‰‡`);
                
                let totalSize = 0;
                let optimizedCount = 0;
                
                images.forEach(img => {
                    totalSize += img.originalSize;
                    if (img.file.optimized) optimizedCount++;
                });

                log(`æ€»å¤§å°: ${Math.round(totalSize / 1024)} KB`);
                log(`å·²ä¼˜åŒ–: ${optimizedCount} å¼ `);
                
                updateStats(images);
            } catch (error) {
                log(`æ‰«æå¤±è´¥: ${error.message}`);
            }
        }

        // æ˜¾ç¤ºç»Ÿè®¡
        function showStats() {
            try {
                const stats = testOptimizer.getOptimizationStats();
                log('=== è¯¦ç»†ç»Ÿè®¡ ===');
                log(`æ€»å›¾ç‰‡æ•°: ${stats.totalImages}`);
                log(`æ€»å¤§å°: ${stats.totalSizeMB} MB`);
                log(`å·²ä¼˜åŒ–: ${stats.optimizedImages} å¼ `);
                log(`å¯èŠ‚çœ: ${stats.potentialSavings} KB`);
                
                updateStatsDisplay(stats);
            } catch (error) {
                log(`è·å–ç»Ÿè®¡å¤±è´¥: ${error.message}`);
            }
        }

        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStats(images) {
            const container = document.getElementById('stats-container');
            
            let totalSize = 0;
            let optimizedCount = 0;
            let totalOriginalSize = 0;
            
            images.forEach(img => {
                totalSize += img.file.size || img.originalSize;
                totalOriginalSize += img.originalSize;
                if (img.file.optimized) optimizedCount++;
            });

            const savedSize = totalOriginalSize - totalSize;
            const compressionRatio = totalOriginalSize > 0 ? (savedSize / totalOriginalSize * 100).toFixed(1) : 0;

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${images.length}</div>
                    <div class="stat-label">æ€»å›¾ç‰‡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.round(totalSize / 1024)}</div>
                    <div class="stat-label">å½“å‰å¤§å° (KB)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${optimizedCount}</div>
                    <div class="stat-label">å·²ä¼˜åŒ–</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${compressionRatio}%</div>
                    <div class="stat-label">å‹ç¼©ç‡</div>
                </div>
            `;
        }

        function updateStatsDisplay(stats) {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.totalImages}</div>
                    <div class="stat-label">æ€»å›¾ç‰‡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.totalSizeMB}</div>
                    <div class="stat-label">æ€»å¤§å° (MB)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.optimizedImages}</div>
                    <div class="stat-label">å·²ä¼˜åŒ–</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.potentialSavings}</div>
                    <div class="stat-label">å¯èŠ‚çœ (KB)</div>
                </div>
            `;
        }

        // åˆ›å»ºæµ‹è¯•æ•°æ®
        function createTestData(count) {
            log(`å¼€å§‹åˆ›å»º ${count} ä¸ªæµ‹è¯•æ‰“å¡...`);
            
            const data = StorageManager.getData();
            if (!data.dakas) data.dakas = [];

            for (let i = 0; i < count; i++) {
                const daka = {
                    id: `test_daka_${Date.now()}_${i}`,
                    title: `æµ‹è¯•æ‰“å¡ ${i + 1}`,
                    content: `è¿™æ˜¯ç¬¬ ${i + 1} ä¸ªæµ‹è¯•æ‰“å¡å†…å®¹`,
                    tags: ['æµ‹è¯•', 'æ‰¹é‡ä¼˜åŒ–'],
                    createTime: new Date().toISOString(),
                    updateTime: new Date().toISOString(),
                    punchRecords: [],
                    starred: false
                };

                // æ·»åŠ æµ‹è¯•å›¾ç‰‡
                const testImages = generateTestImages(2 + Math.floor(Math.random() * 3));
                daka.punchRecords.push({
                    date: new Date().toISOString().slice(0, 10),
                    text: `æµ‹è¯•æ‰“å¡è®°å½• ${i + 1}`,
                    files: testImages
                });

                data.dakas.push(daka);
            }

            StorageManager.saveData(data);
            log(`æˆåŠŸåˆ›å»º ${count} ä¸ªæµ‹è¯•æ‰“å¡`);
            scanImages();
        }

        // ç”Ÿæˆæµ‹è¯•å›¾ç‰‡
        function generateTestImages(count) {
            const images = [];
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];
            
            for (let i = 0; i < count; i++) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // éšæœºå¤§å°ï¼Œæ¨¡æ‹Ÿä¸åŒè´¨é‡çš„å›¾ç‰‡
                const sizes = [
                    { width: 1920, height: 1080, quality: 0.9 },
                    { width: 1200, height: 800, quality: 0.8 },
                    { width: 800, height: 600, quality: 0.7 },
                    { width: 400, height: 300, quality: 0.6 }
                ];
                
                const size = sizes[Math.floor(Math.random() * sizes.length)];
                canvas.width = size.width;
                canvas.height = size.height;
                
                // ç»˜åˆ¶æµ‹è¯•å›¾ç‰‡
                ctx.fillStyle = colors[i % colors.length];
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = 'white';
                ctx.font = `${Math.min(canvas.width, canvas.height) / 10}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(`æµ‹è¯•å›¾ç‰‡ ${i + 1}`, canvas.width / 2, canvas.height / 2);
                
                const dataUrl = canvas.toDataURL('image/jpeg', size.quality);
                const sizeBytes = Math.round((dataUrl.length * 3) / 4);
                
                images.push({
                    name: `test_image_${i + 1}.jpg`,
                    type: 'image/jpeg',
                    size: sizeBytes,
                    data: dataUrl
                });
            }
            
            return images;
        }

        // æ·»åŠ å¤§å›¾ç‰‡
        function addLargeImages() {
            log('æ·»åŠ å¤§å›¾ç‰‡åˆ°ç°æœ‰æ‰“å¡...');
            
            const data = StorageManager.getData();
            if (!data.dakas || data.dakas.length === 0) {
                log('æ²¡æœ‰æ‰¾åˆ°æ‰“å¡æ•°æ®ï¼Œè¯·å…ˆåˆ›å»ºæµ‹è¯•æ•°æ®');
                return;
            }

            // ä¸ºæ¯ä¸ªæ‰“å¡æ·»åŠ ä¸€å¼ å¤§å›¾ç‰‡
            data.dakas.forEach((daka, index) => {
                if (daka.punchRecords && daka.punchRecords.length > 0) {
                    const largeImage = generateLargeTestImage(index);
                    daka.punchRecords[0].files = daka.punchRecords[0].files || [];
                    daka.punchRecords[0].files.push(largeImage);
                }
            });

            StorageManager.saveData(data);
            log('å¤§å›¾ç‰‡æ·»åŠ å®Œæˆ');
            scanImages();
        }

        // ç”Ÿæˆå¤§å›¾ç‰‡
        function generateLargeTestImage(index) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // åˆ›å»ºå¤§å°ºå¯¸å›¾ç‰‡
            canvas.width = 2560;
            canvas.height = 1440;
            
            // åˆ›å»ºæ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ·»åŠ æ–‡å­—
            ctx.fillStyle = 'white';
            ctx.font = '120px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`å¤§å›¾ç‰‡ ${index + 1}`, canvas.width / 2, canvas.height / 2);
            
            const dataUrl = canvas.toDataURL('image/jpeg', 0.95);
            const sizeBytes = Math.round((dataUrl.length * 3) / 4);
            
            return {
                name: `large_image_${index + 1}.jpg`,
                type: 'image/jpeg',
                size: sizeBytes,
                data: dataUrl
            };
        }

        // å¼€å§‹ä¼˜åŒ–
        async function startOptimization() {
            log('å¼€å§‹æ‰¹é‡ä¼˜åŒ–...');
            
            try {
                testOptimizer.onProgress = (progress) => {
                    log(`è¿›åº¦: ${progress.current}/${progress.total} - ${progress.currentImage}`);
                };
                
                testOptimizer.onComplete = (result) => {
                    log('=== ä¼˜åŒ–å®Œæˆ ===');
                    log(`å¤„ç†å›¾ç‰‡: ${result.processedImages}/${result.totalImages}`);
                    log(`èŠ‚çœç©ºé—´: ${result.savedSpaceMB} MB`);
                    scanImages();
                };
                
                const result = await testOptimizer.optimizeAllDakaImages({
                    targetSizeKB: 60,
                    skipIfSmaller: true,
                    createBackup: false
                });
                
                log('æ‰¹é‡ä¼˜åŒ–ä»»åŠ¡å·²å®Œæˆ');
                
            } catch (error) {
                log(`ä¼˜åŒ–å¤±è´¥: ${error.message}`);
            }
        }

        // è‡ªå®šä¹‰ä¼˜åŒ–
        async function optimizeWithSettings() {
            const targetSize = prompt('è¯·è¾“å…¥ç›®æ ‡å¤§å° (KB):', '40');
            if (!targetSize) return;
            
            const skipSmall = confirm('æ˜¯å¦è·³è¿‡å·²ç»è¾ƒå°çš„å›¾ç‰‡ï¼Ÿ');
            const createBackup = confirm('æ˜¯å¦åˆ›å»ºæ•°æ®å¤‡ä»½ï¼Ÿ');
            
            log(`å¼€å§‹è‡ªå®šä¹‰ä¼˜åŒ– (ç›®æ ‡: ${targetSize}KB)...`);
            
            try {
                testOptimizer.onProgress = (progress) => {
                    log(`è¿›åº¦: ${progress.current}/${progress.total} - å·²èŠ‚çœ: ${Math.round(progress.savedSpace / 1024)}KB`);
                };
                
                testOptimizer.onComplete = (result) => {
                    log('=== è‡ªå®šä¹‰ä¼˜åŒ–å®Œæˆ ===');
                    log(`å¤„ç†å›¾ç‰‡: ${result.processedImages}/${result.totalImages}`);
                    log(`èŠ‚çœç©ºé—´: ${result.savedSpaceMB} MB`);
                    scanImages();
                };
                
                await testOptimizer.optimizeAllDakaImages({
                    targetSizeKB: parseInt(targetSize),
                    skipIfSmaller: skipSmall,
                    createBackup: createBackup
                });
                
            } catch (error) {
                log(`è‡ªå®šä¹‰ä¼˜åŒ–å¤±è´¥: ${error.message}`);
            }
        }

        // æ˜¾ç¤ºä¼˜åŒ–å¼¹çª—
        function showOptimizationModal() {
            if (testOptimizer) {
                testOptimizer.showOptimizationModal();
            } else {
                log('ä¼˜åŒ–å™¨æœªåˆå§‹åŒ–');
            }
        }

        // æ¸…é™¤æµ‹è¯•æ•°æ®
        function clearTestData() {
            if (!confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼Ÿ')) return;
            
            const data = StorageManager.getData();
            data.dakas = (data.dakas || []).filter(daka => !daka.id.startsWith('test_daka_'));
            StorageManager.saveData(data);
            
            log('æµ‹è¯•æ•°æ®å·²æ¸…é™¤');
            scanImages();
        }

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('testFileInput').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            log(`å¼€å§‹å¤„ç† ${files.length} ä¸ªä¸Šä¼ çš„æ–‡ä»¶...`);
            
            try {
                const compressedImages = [];
                
                for (const file of files) {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        const dataUrl = await new Promise((resolve) => {
                            reader.onload = e => resolve(e.target.result);
                            reader.readAsDataURL(file);
                        });
                        
                        compressedImages.push({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: dataUrl
                        });
                    }
                }
                
                if (compressedImages.length > 0) {
                    // åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•æ‰“å¡
                    const data = StorageManager.getData();
                    if (!data.dakas) data.dakas = [];
                    
                    const newDaka = {
                        id: `uploaded_daka_${Date.now()}`,
                        title: `ä¸Šä¼ æµ‹è¯• - ${new Date().toLocaleString()}`,
                        content: `åŒ…å« ${compressedImages.length} å¼ ä¸Šä¼ çš„å›¾ç‰‡`,
                        tags: ['ä¸Šä¼ æµ‹è¯•'],
                        createTime: new Date().toISOString(),
                        updateTime: new Date().toISOString(),
                        punchRecords: [{
                            date: new Date().toISOString().slice(0, 10),
                            text: 'ä¸Šä¼ çš„å›¾ç‰‡æµ‹è¯•',
                            files: compressedImages
                        }],
                        starred: false
                    };
                    
                    data.dakas.push(newDaka);
                    StorageManager.saveData(data);
                    
                    log(`æˆåŠŸæ·»åŠ  ${compressedImages.length} å¼ å›¾ç‰‡åˆ°æ–°æ‰“å¡`);
                    scanImages();
                }
                
            } catch (error) {
                log(`å¤„ç†ä¸Šä¼ æ–‡ä»¶å¤±è´¥: ${error.message}`);
            }
            
            e.target.value = '';
        });

        // æ•°æ®ç®¡ç†åŠŸèƒ½
        function exportData() {
            const data = StorageManager.getData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daka_data_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            log('æ•°æ®å·²å¯¼å‡º');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        StorageManager.saveData(data);
                        log('æ•°æ®å¯¼å…¥æˆåŠŸ');
                        scanImages();
                    } catch (error) {
                        log(`æ•°æ®å¯¼å…¥å¤±è´¥: ${error.message}`);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function createBackup() {
            const data = StorageManager.getData();
            const backupKey = `backup_${Date.now()}`;
            localStorage.setItem(backupKey, JSON.stringify(data));
            log(`å¤‡ä»½å·²åˆ›å»º: ${backupKey}`);
        }

        function resetAll() {
            if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
            
            localStorage.clear();
            log('æ‰€æœ‰æ•°æ®å·²é‡ç½®');
            scanImages();
        }
    </script>
</body>
</html>